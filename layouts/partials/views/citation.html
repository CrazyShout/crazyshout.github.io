{{/* è¦†å†™ä¸»é¢˜çš„ citation è§†å›¾ï¼ˆå•æ–‡ä»¶ç‰ˆï¼‰
   - å·¦ä¾§ç¼©ç•¥å›¾ï¼šç­‰æ¯”ç¼©æ”¾ï¼ˆResizeï¼‰ï¼Œä¸è£å‰ª
   - å³ä¾§ï¼šæ ‡é¢˜ / ä½œè€…ï¼ˆadmin åŠ ç²—ï¼Œæ˜¾ç¤ºä½œè€…æ¡£æ¡ˆåï¼‰/ ä¼šè®®ç®€ç§°
   - åº•éƒ¨ï¼šé“¾æ¥å¾½ç« ï¼ˆå¸¦å°å›¾æ ‡ï¼‰
*/}}

{{- $fragment := .fragment | default "item" -}}

{{- if eq $fragment "start" -}}
  <div class="space-y-6">
{{- else if eq $fragment "end" -}}
  </div>
{{- else -}}
  {{- $item := .item -}}

  {{/* 1) ç¼©ç•¥å›¾ï¼šä¼˜å…ˆåŒ¹é… featured.*ï¼›ç­‰æ¯”ç¼©æ”¾ï¼Œä¸è£å‰ª */}}
  {{- $img := or ($item.Resources.GetMatch "featured.*") ($item.Resources.GetMatch "*featured*") -}}

  <div class="flex gap-5 items-start">
    {{ with $img }}
      {{ $thumb := .Resize "320x" }}  {{/* æºå›¾ç”Ÿæˆ 640 å®½ï¼Œä¸‹é¢å±•ç¤º 320 å®½ */}}
      <a href="{{ $item.RelPermalink }}" class="shrink-0">
        <img src="{{ $thumb.RelPermalink }}" alt="{{ $item.Title }}"
             class="rounded-md w-[320px] h-auto object-contain" loading="lazy">
      </a>
    {{ end }}

    <div class="min-w-0">
      {{/* 2) æ ‡é¢˜ */}}
      <div class="font-semibold">
        <a href="{{ $item.RelPermalink }}" class="hover:underline">
          {{ $item.Title }}
        </a>
      </div>

      {{/* 3) ä½œè€…ï¼ˆæŠŠ authors ä¸­çš„ç”¨æˆ·åæ˜ å°„ä¸ºä½œè€…æ¡£æ¡ˆæ ‡é¢˜ï¼›admin/superuser åŠ ç²—ï¼‰ */}}
      {{ $authorPieces := slice }}
      {{ range $name := $item.Params.authors }}
        {{- $p := site.GetPage (printf "authors/%s" $name) -}}
        {{- if $p -}}
          {{- $disp := (or $p.Params.title $p.Title) -}}
          {{- $isSuper := (or $p.Params.superuser false) -}}
          {{- $html := cond $isSuper (printf "<strong>%s</strong>" $disp) $disp | safeHTML -}}
          {{- $authorPieces = $authorPieces | append $html -}}
        {{- else -}}
          {{- $authorPieces = $authorPieces | append $name -}}
        {{- end -}}
      {{- end -}}
      {{ $authorsHTML := delimit $authorPieces ", " | safeHTML }}

      {{/* 4) ä¼šè®®ï¼ˆæ”¯æŒåŒæ—¶æ˜¾ç¤ºç®€ç§°ä¸å…¨ç§°ï¼›è‡ªåŠ¨å»æ‰å‰ç¼€ In å’Œ * ç²—æ–œä½“ç¬¦å·ï¼‰ */}}
      {{ $short := $item.Params.publication_short | default "" | plainify | replaceRE `(?i)^\s*in\s+` "" }}
      {{ $full  := $item.Params.publication         | default "" | plainify | replaceRE `(?i)^\s*in\s+` "" }}

      {{/* ä¼˜å…ˆï¼šç®€ç§° (å…¨ç§°)ã€‚è‹¥ä¸¤è€…ç›¸åŒæˆ–åªæœ‰ä¸€ä¸ªï¼Œå°±åªæ˜¾ç¤ºä¸€ä¸ª */}}
      {{ $venue := "" }}
      {{ if and $short $full }}
        {{ if ne $short $full }}
          {{ $venue = printf "%s (%s)" $full $short }}
        {{ else }}
          {{ $venue = $short }}
        {{ end }}
      {{ else if $short }}
        {{ $venue = $short }}
      {{ else if $full }}
        {{ $venue = $full }}
      {{ end }}

      <div class="text-sm opacity-80 mt-1">
        {{ $authorsHTML }}{{ with $item.Date }} ({{ . | time.Format "2006" }}){{ end }}.
        {{ with $venue }} In <em>{{ . }}</em>.{{ end }}
      </div>

      {{/* 5) é“¾æ¥å¾½ç« åŒºï¼ˆå¸¦å°æ–¹æ¡†ä¸å°å›¾æ ‡ï¼‰ */}}
      <div class="mt-2 flex flex-wrap gap-2 pub-links">
        {{ $cite := $item.Resources.GetMatch "cite.*" }}
        {{ with $cite }}
          <a class="pub-badge" href="{{ .RelPermalink }}"><span class="i">ğŸ“„</span> CITE</a>
        {{ end }}
        {{ with $item.Params.url_pdf }}<a class="pub-badge" href="{{ . }}"><span class="i">ğŸ“•</span> PDF</a>{{ end }}
        {{ with $item.Params.url_code }}<a class="pub-badge" href="{{ . }}"><span class="i">ğŸ’»</span> CODE</a>{{ end }}
        {{ with $item.Params.url_dataset }}<a class="pub-badge" href="{{ . }}"><span class="i">ğŸ§°</span> DATASET</a>{{ end }}
        {{ with $item.Params.url_video }}<a class="pub-badge" href="{{ . }}"><span class="i">ğŸ¬</span> VIDEO</a>{{ end }}
        {{ with $item.Params.url_source }}<a class="pub-badge" href="{{ . }}"><span class="i">ğŸ“„</span> SOURCE DOCUMENT</a>{{ end }}
        {{ with $item.Params.doi }}<a class="pub-badge" href="https://doi.org/{{ . }}"><span class="i">ğŸ”—</span> DOI</a>{{ end }}
      </div>
    </div>
  </div>
{{- end -}}
